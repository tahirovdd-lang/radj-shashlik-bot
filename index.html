<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Radj Shashlik</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800;900&display=swap" rel="stylesheet">

<style>
:root{
    --blue:#4a90e2;
    --green:#2e7d32;
    --bg:#f2f4f7;
}

body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
    background:linear-gradient(180deg,#eef2f7,#f7f9fc);
    color:#1c1c1e;
}

/* HEADER */
.header{
    padding:16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    background:linear-gradient(135deg,#4a90e2,#6fb1ff);
    color:#fff;
    box-shadow:0 6px 20px rgba(0,0,0,.12);
}
.logo-wrap{display:flex;align-items:center;gap:12px;}
.header img{max-width:110px;}
.header-title{
    font-family:'Montserrat',sans-serif;
    font-size:30px;
    font-weight:900;
}
.search-btn{
    width:38px;height:38px;
    border-radius:50%;
    border:none;
    background:rgba(255,255,255,.25);
    color:#fff;
    font-size:18px;
}

/* SEARCH */
.search-input{
    display:none;
    margin:10px;
    padding:14px;
    width:calc(100% - 20px);
    border-radius:18px;
    border:none;
    box-shadow:0 6px 20px rgba(0,0,0,.08);
}

/* BUTTONS */
.langs,.types,.categories,.payments{
    display:flex;
    gap:10px;
    padding:10px;
    overflow-x:auto;
}
.btn{
    padding:10px 18px;
    border-radius:22px;
    background:#fff;
    border:1px solid #e1e5ea;
    font-size:14px;
    font-weight:600;
    white-space:nowrap;
}
.btn.active{
    background:linear-gradient(135deg,#4a90e2,#6fb1ff);
    color:#fff;
    border:none;
}

/* INPUTS */
.input,textarea{
    margin:10px;
    padding:14px;
    width:calc(100% - 20px);
    border-radius:18px;
    border:none;
    font-size:14px;
    background:#fff;
}
textarea{resize:none;}

/* PRODUCTS */
.products{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:14px;
    padding:12px;
}
.card{
    background:#fff;
    border-radius:20px;
    padding:12px;
    text-align:center;
    box-shadow:0 10px 24px rgba(0,0,0,.08);
}
.img{
    height:110px;
    border-radius:16px;
    background:#f0f2f5;
    overflow:hidden;
}
.img img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
}
.price{margin-top:8px;font-weight:800;color:var(--green);}
.name{font-size:14px;margin-top:6px;}

/* COUNTER */
.counter{
    display:flex;
    justify-content:center;
    gap:12px;
    margin-top:8px;
}
.counter span{font-weight:800;}
.counter button{
    width:32px;height:32px;
    border-radius:50%;
    border:none;
    font-size:18px;
}

/* CART */
.cart{
    background:#fff;
    margin:12px;
    padding:16px;
    border-radius:22px;
    box-shadow:0 10px 24px rgba(0,0,0,.06);
}
.order-btn{
    width:100%;
    padding:16px;
    margin-top:14px;
    border:none;
    border-radius:20px;
    background:linear-gradient(135deg,#4a90e2,#6fb1ff);
    color:#fff;
    font-size:16px;
    font-weight:800;
}

/* CARD PAYMENT BOX (Variant B) */
.cardpay{
    display:none;
    margin:10px;
    padding:14px;
    border-radius:18px;
    border:1px solid #e1e5ea;
    background:linear-gradient(180deg,#ffffff,#f7fbff);
}
.cardpay .row{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:10px;
}
.small{
    font-size:12px;
    opacity:.75;
    line-height:1.3;
}
.kv{
    display:flex;
    justify-content:space-between;
    gap:10px;
    margin-top:8px;
    font-weight:700;
}
.kv span:first-child{opacity:.7;font-weight:600;}
.secondary-btn{
    padding:12px 14px;
    border-radius:16px;
    border:1px solid #e1e5ea;
    background:#fff;
    font-weight:800;
    cursor:pointer;
}
.note-ok{
    margin-top:10px;
    font-size:12px;
    color:#2e7d32;
    font-weight:700;
    display:none;
}
.qrwrap{
    margin-top:12px;
    display:flex;
    justify-content:center;
}
.qrbox{
    border-radius:16px;
    background:#fff;
    padding:10px;
    box-shadow:0 10px 24px rgba(0,0,0,.08);
}
</style>
</head>

<body>

<div class="header">
    <div class="logo-wrap">
        <img src="logo.png" alt="logo">
        <div class="header-title">Radj Shashlik</div>
    </div>
    <button class="search-btn" onclick="toggleSearch()">üîç</button>
</div>

<input id="search" class="search-input">

<div class="langs">
    <button class="btn active" onclick="setLang('ru',this)">RU</button>
    <button class="btn" onclick="setLang('uz',this)">UZ</button>
    <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<div class="types">
    <button class="btn active" onclick="setType('delivery',this)" id="btnDelivery"></button>
    <button class="btn" onclick="setType('pickup',this)" id="btnPickup"></button>
</div>

<input id="address" class="input">
<input id="phone" class="input">

<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<div class="cart">
    <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
    <textarea id="comment" rows="3"></textarea>

    <div class="payments">
        <button class="btn active" onclick="setPayment('cash')" id="payCash">üíµ –ù–∞–ª–∏—á–Ω—ã–µ</button>
        <button class="btn" onclick="setPayment('click')" id="payClick">üí≥ CLICK</button>
        <button class="btn" onclick="setPayment('card')" id="payCard">üí≥ –û–Ω–ª–∞–π–Ω –Ω–∞ –∫–∞—Ä—Ç—É</button>
    </div>

    <!-- VARIANT B: card transfer info + QR -->
    <div class="cardpay" id="cardPayBox">
        <div style="font-weight:900;font-size:14px" id="cardPayTitle">üí≥ –û–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ –∫–∞—Ä—Ç—É</div>

        <div class="kv">
            <span id="cardLabel">–ö–∞—Ä—Ç–∞</span>
            <span id="cardNumberText">9860 1001 2635 9502</span>
        </div>
        <div class="kv">
            <span id="ownerLabel">–í–ª–∞–¥–µ–ª–µ—Ü</span>
            <span id="cardOwnerText">Daler Takhirov</span>
        </div>
        <div class="kv">
            <span id="amountLabel">–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ</span>
            <span><span id="amountToPay">0</span> —Å—É–º</span>
        </div>

        <div class="row">
            <button class="secondary-btn" onclick="copyCard()" id="copyCardBtn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É</button>
            <button class="secondary-btn" onclick="copyAmount()" id="copyAmountBtn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—É</button>
            <button class="secondary-btn" onclick="openProofChat()" id="sendCheckBtn">üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫</button>
        </div>

        <div class="qrwrap">
            <div class="qrbox">
                <canvas id="qrCanvas" width="220" height="220"></canvas>
            </div>
        </div>
        <div class="small" style="text-align:center;margin-top:8px" id="qrHint">
            –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –≤ Payme/Click/–±–∞–Ω–∫–æ–≤—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ —Å–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–µ–≤–æ–¥.
        </div>

        <div class="small" id="cardPayHint" style="margin-top:10px">
            –ü–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω/—á–µ–∫ –≤ —á–∞—Ç (–∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫¬ª), –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ ¬´–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑¬ª.
        </div>
        <div class="note-ok" id="copiedNote">‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ</div>
    </div>

    <button class="order-btn" onclick="sendOrder()" id="orderBtn"></button>
</div>

<script>
Telegram.WebApp.ready();

/* ====== SETTINGS (Variant B) ====== */
const CARD_NUMBER_RAW = "9860100126359502";
const CARD_OWNER = "Daler Takhirov";
const MANAGER_USERNAME = "Yaki_Tahirov"; // ‚úÖ –±–µ–∑ @

/* ====== APP STATE ====== */
let lang='ru',category='salads',type='delivery',cart={},searchValue='';
let payment='cash';

const TEXT={
ru:{
  delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',
  cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',comment:'üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',search:'üîé –ü–æ–∏—Å–∫ –±–ª—é–¥',
  payCard:'üí≥ –û–Ω–ª–∞–π–Ω –Ω–∞ –∫–∞—Ä—Ç—É',
  cardTitle:'üí≥ –û–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ –∫–∞—Ä—Ç—É', cardLabel:'–ö–∞—Ä—Ç–∞', ownerLabel:'–í–ª–∞–¥–µ–ª–µ—Ü', amountLabel:'–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ',
  copyCard:'üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É', copyAmount:'üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—É', sendCheck:'üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫',
  qrHint:'–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –≤ Payme/Click/–±–∞–Ω–∫–æ–≤—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ —Å–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–µ–≤–æ–¥.',
  cardHint:'–ü–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω/—á–µ–∫ –≤ —á–∞—Ç (–∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫¬ª), –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ ¬´–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑¬ª.',
  emptyCart:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è'
},
uz:{
  delivery:'üöö Yetkazib berish',pickup:'üèÉ Olib ketish',address:'üìç Manzil',phone:'üìû Telefon',
  cart:'üõí Savat',order:'Buyurtma berish',comment:'üí¨ Izoh',search:'üîé Qidirish',
  payCard:'üí≥ Karta orqali online',
  cardTitle:'üí≥ Kartaga o‚Äòtkazma orqali to‚Äòlov', cardLabel:'Karta', ownerLabel:'Egasi', amountLabel:'To‚Äòlov summasi',
  copyCard:'üìã Kartani nusxalash', copyAmount:'üìã Summani nusxalash', sendCheck:'üì© Chekni yuborish',
  qrHint:'QR-ni Payme/Click/bank ilovasida skaner qiling va o‚Äòtkazma qiling.',
  cardHint:'O‚Äòtkazmadan so‚Äòng chatga —á–µ–∫/skrin yuboring (¬´Chekni yuborish¬ª), so‚Äòng ¬´Buyurtma berish¬ª ni bosing.',
  emptyCart:'Savat bo‚Äòsh'
},
en:{
  delivery:'üöö Delivery',pickup:'üèÉ Pickup',address:'üìç Address',phone:'üìû Phone',
  cart:'üõí Cart',order:'Place order',comment:'üí¨ Comment',search:'üîé Search',
  payCard:'üí≥ Pay by card',
  cardTitle:'üí≥ Pay by bank transfer', cardLabel:'Card', ownerLabel:'Owner', amountLabel:'Amount to pay',
  copyCard:'üìã Copy card', copyAmount:'üìã Copy amount', sendCheck:'üì© Send receipt',
  qrHint:'Scan QR in Payme/Click/banking app and make a transfer.',
  cardHint:'After transfer, send a screenshot/receipt in chat (‚ÄúSend receipt‚Äù), then press ‚ÄúPlace order‚Äù.',
  emptyCart:'Cart is empty'
}
};

const CATS={
ru:{salads:'ü•ó –°–∞–ª–∞—Ç—ã',kebab:'üî• –®–∞—à–ª—ã–∫',national:'üç≤ –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–ª—é–¥–∞',grill:'ü•© –ë–ª—é–¥–∞ –Ω–∞ –º–∞–Ω–≥–∞–ª–µ',first:'üçú –ü–µ—Ä–≤—ã–µ –±–ª—é–¥–∞',drinks:'ü•§ –ù–∞–ø–∏—Ç–∫–∏',bread:'ü•ñ –•–ª–µ–±'},
uz:{salads:'ü•ó Salatlar',kebab:'üî• Shashlik',national:'üç≤ Milliy taomlar',grill:'ü•© Mangal taomlari',first:'üçú Birinchi taomlar',drinks:'ü•§ Ichimliklar',bread:'ü•ñ Non'},
en:{salads:'ü•ó Salads',kebab:'üî• Kebab',national:'üç≤ National dishes',grill:'ü•© Grill dishes',first:'üçú First dishes',drinks:'ü•§ Drinks',bread:'ü•ñ Bread'}
};

const MENU = {
salads:[
    ['–°–≤–µ–∂–∏–π',30000,'images/svejiy.jpg'],
    ['–°–∞–ª–∞—Ç ¬´–ê—á–∏—á—É–∫¬ª',30000,'images/achichuk.png'],
    ['–°–∞–ª–∞—Ç ¬´–®–∞–∫–∞—Ä–æ–ø¬ª',30000,'images/shakarop.png'],
    ['–°–∞–ª–∞—Ç ¬´–ß–∏—Ä–æ–∫—á–∏¬ª',30000,'images/chirokchi.png'],
    ['–°–∞–ª–∞—Ç ¬´–ú—è—Å–Ω–æ–π¬ª',35000,'images/myasnoy.jpg'],
    ['–°–∞–ª–∞—Ç ¬´–ì—Ä–µ—á–µ—Å–∫–∏–π¬ª',40000,'images/grecheskiy.jpg'],
    ['–°–∞–ª–∞—Ç ¬´–ú–∞–∂–Ω—É–Ω—Ç–æ–ª¬ª',30000,'images/mazhnuntol.jpg'],
    ['–°–∞–ª–∞—Ç ¬´–ú—É–∂—Å–∫–æ–π –∫–∞–ø—Ä–∏–∑¬ª',35000,'images/muzhskoy_kapriz.jpg'],
    ['–°–∞–ª–∞—Ç ¬´–î–∞–º—Å–∫–∏–π –∫–∞–ø—Ä–∏–∑¬ª',35000,'images/damskiy_kapriz.jpg'],
    ['–°–∞–ª–∞—Ç ¬´–û–ª–∏–≤—å–µ¬ª',30000,'images/olivye.jpg'],
    ['–°–∞–ª–∞—Ç ¬´–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π¬ª',35000,'images/frantsuzskiy.jpg'],
    ['–°–∞–ª–∞—Ç ¬´–°–º–∞–∫¬ª',35000,'images/smak.jpg'],
    ['–¶–µ–∑–∞—Ä—å',35000,'images/cezar.jpg'],
    ['–•—Ä—É—Å—Ç—è—â–∏–π –±–∞–∫–ª–∞–∂–∞–Ω',45000,'images/baklajan.jpg']
],
kebab:[
    ['–ú–æ–ª–æ—Ç—ã–π',28000,'images/molotiy.jpg'],
    ['–ú–æ–ª–æ—Ç—ã–π –º–∏–∫—Å',30000,'images/molotiy_mix.jpg'],
    ['–ö—É—Å–∫–æ–≤–æ–π –±–∞—Ä–∞–Ω–∏–Ω–∞',30000,'images/kuskovoy_baranina.jpg'],
    ['–†—É–ª–µ—Ç',30000,'images/rulet.jpg'],
    ['–ù–∞–ø–æ–ª–µ–æ–Ω',30000,'images/napoleon.jpg'],
    ['–ö–æ—Ä–µ–π–∫–∞',40000,'images/koreyka.jpg'],
    ['–ë—ã–∫–∏–Ω',40000,'images/bykin.jpg'],
    ['–†–µ–±—Ä—ã—à–∫–∏ (—Å–µ–º–µ—á–∫–∏)',30000,'images/rebryshki.jpg'],
    ['–ü–µ—á–µ–Ω—å',22000,'images/pechen.jpg'],
    ['–ö—É—Ä–¥—é–∫',30000,'images/kurdyuk.jpg'],
    ['–ü–æ–º–∏–¥–æ—Ä—ã 3—à—Ç',12000,'images/pomidory.jpg'],
    ['–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å 3—à—Ç',10000,'images/kartofel.jpg'],
    ['–ì–æ–≤—è–∂—å—è –≤—ã—Ä–µ–∑–∫–∞',30000,'images/govyazhya_vyrezka.jpg'],
    ['–ö—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ',22000,'images/kurinoe_file.jpg'],
    ['–ö—É—Ä–∏–Ω—ã–µ –∫—Ä—ã–ª—ã—à–∫–∏',22000,'images/krylyshki.jpg'],
    ['–ë–æ–º–±–æ—á–∫–∞',30000,'images/bombochka.jpg'],
    ['–ì–æ–≤—è–¥–∏–Ω–∞ –æ—Ç–±–∏–≤–Ω–∞—è',35000,'images/otbivnaya.jpg'],
    ['–ö–æ—Ç–ª–µ—Ç—ã 1—à—Ç',30000,'images/kotlety.jpg'],
    ['–ß–µ–±—É—Ä–µ–∫ –Ω–∞ –º–∞–Ω–≥–∞–ª–µ',30000,'images/cheburek.jpg'],
    ['–ö–æ–ª–±–∞—Å–∫–∏ –æ—Å—Ç—Ä—ã–µ 1—à—Ç',17000,'images/kolbaski_ostrye.jpg'],
    ['–û–≤–æ—â–Ω–æ–π –º–∏–∫—Å',15000,'images/ovoshchnoy_mix.jpg'],
    ['–ö–æ–ª–±–∞—Å–∫–∏ –º–æ–ª–æ—á–Ω—ã–µ 1—à—Ç',17000,'images/kolbaski_molochnye.jpg'],
    ['–ì—Ä–∏–±—ã —à–∞–º–ø–∏–Ω—å–æ–Ω—ã',15000,'images/griby.jpg']
],
national:[
    ['–ñ–∏–∑ –ë–∏–∑ –ë–∞—Ä–∞–Ω–∏–Ω–∞ 1–∫–≥',260000,'images/jiz_biz_baranina_1kg.jpg'],
    ['–ñ–∏–∑ –ë–∏–∑ –ë–∞—Ä–∞–Ω–∏–Ω–∞ 0.5–∫–≥',130000,'images/jiz_biz_baranina_05kg.jpg'],
    ['–ñ–∏–∑ –ë–∏–∑ –∏–∑ –≤—ã—Ä–µ–∑–∫–∏ 1–∫–≥',300000,'images/jiz_biz_vyrezka_1kg.jpg'],
    ['–ñ–∏–∑ –ë–∏–∑ –∏–∑ –≤—ã—Ä–µ–∑–∫–∏ 0.5–∫–≥',150000,'images/jiz_biz_vyrezka_05kg.jpg']
],
grill:[
    ['–°—Ç–µ–π–∫ –∫—É—Ä–∏–Ω—ã–π',100000,'images/steyk_kuriniy.jpg'],
    ['–°—Ç–µ–π–∫ –¢–∏–±–æ–Ω 100–≥—Ä',20000,'images/steyk_tibon.jpg'],
    ['–°—Ç–µ–π–∫ –í–∞–≥—É—Ä–∏',200000,'images/steyk_vaguri.jpg'],
    ['–ë–∞—Ä–∞–Ω–∏–Ω–∞ —Å –≥—Ä–∏–±–∞–º–∏ 0.5–∫–≥',100000,'images/baranina_griby_05kg.jpg'],
    ['–ë–∞—Ä–∞–Ω–∏–Ω–∞ —Å –≥—Ä–∏–±–∞–º–∏ 1–∫–≥',200000,'images/baranina_griby_1kg.jpg'],
    ['–ì–æ–≤—è–∂—å—è –≤—ã—Ä–µ–∑–∫–∞ —Å –æ–≤–æ—â–∞–º–∏ 0.5–∫–≥',180000,'images/vyrezka_ovoshi_05kg.jpg'],
    ['–ì–æ–≤—è–∂—å—è –≤—ã—Ä–µ–∑–∫–∞ —Å –æ–≤–æ—â–∞–º–∏ 1–∫–≥',360000,'images/vyrezka_ovoshi_1kg.jpg']
],
first:[
    ['–®—É—Ä–ø–∞',35000,'images/shurpa.jpg'],
    ['–©–∏ –∑–µ–ª–µ–Ω—ã–µ',25000,'images/shi_zelenye.jpg'],
    ['–ë–æ—Ä—â —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π',25000,'images/borsh.jpg'],
    ['–ì—É–∂–∞',25000,'images/guzha.jpg'],
    ['–ú–∞—Å—Ç–∞–≤–∞',25000,'images/mastava.jpg']
],
drinks:[
    ['–ß–∞–π —á–µ—Ä–Ω—ã–π / –∑–µ–ª–µ–Ω—ã–π',5000,'images/chay.jpg'],
    ['–ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º',15000,'images/chay_limon.jpg'],
    ['Fanta 1L',14000,'images/fanta_1l.jpg'],
    ['Fanta 1.5L',18000,'images/fanta_15l.jpg'],
    ['Coca Cola 1L',14000,'images/coca_cola_1l.jpg'],
    ['Coca Cola 1.5L',18000,'images/coca_cola_15l.jpg'],
    ['–°–æ–∫ –°–æ—á–Ω–∞—è –î–æ–ª–∏–Ω–∞ 1L',20000,'images/sok_sochnaya_dolina.png'],
    ['Pepsi 1L',14000,'images/pepsi_1l.jpg'],
    ['Pepsi 1.5L',18000,'images/pepsi_15l.jpg'],
    ['–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–æ–¥–∞ Chortoq 0.5L',15000,'images/chortoq_gaz_05l.jpg'],
    ['–í–æ–¥–∞ –±–µ–∑ –≥–∞–∑–∞ Chortoq 1L',6000,'images/chortoq_1l.jpg'],
    ['–í–æ–¥–∞ –±–µ–∑ –≥–∞–∑–∞ Chortoq 1.5L',8000,'images/chortoq_15l.jpg'],
    ['–õ–∏–º–æ–Ω–∞–¥ –¢–∞—Ä—Ö—É–Ω 0.5L',12000,'images/tarhun_05l.jpg'],
    ['–õ–∏–º–æ–Ω–∞–¥ –î—é—à–µ—Å 0.5L',12000,'images/dyushes_05l.jpg'],
    ['–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ Saber 0.5L',15000,'images/saber_05l.jpg']
],
bread:[
    ['–õ–µ–ø–µ—à–∫–∞ –ß–∞–ø —á–∞–∫ 1—à—Ç',10000,'images/lepyoshka.jpg']
]
};

/* ====== UI RENDER ====== */
function renderProducts(){
    products.innerHTML='';
    MENU[category]
    .filter(i=>i[0].toLowerCase().includes(searchValue))
    .forEach(([n,p,img])=>{
        cart[n]=cart[n]||0;
        products.innerHTML+=`
        <div class="card">
            <div class="img">
                <img src="${img || 'logo.png'}" alt="">
            </div>
            <div class="price">${p} —Å—É–º</div>
            <div class="name">${n}</div>
            <div class="counter">
                <button onclick="chg('${n}',-1)">‚àí</button>
                <span id="c_${n}">${cart[n]}</span>
                <button onclick="chg('${n}',1)">+</button>
            </div>
        </div>`;
    });
    upd();
}

function toggleSearch(){search.style.display=search.style.display==='block'?'none':'block';}
search.oninput=e=>{searchValue=e.target.value.toLowerCase();renderProducts();};

function renderCats(){
    cats.innerHTML='';
    for(let k in CATS[lang]){
        cats.innerHTML+=`<button class="btn ${k===category?'active':''}" onclick="category='${k}';renderCats();renderProducts()">${CATS[lang][k]}</button>`;
    }
}

/* ====== CART LOGIC ====== */
function chg(n,v){
    cart[n]=Math.max(0,(cart[n]||0)+v);
    const el=document.getElementById('c_'+n);
    if(el) el.innerText=cart[n];
    upd();
}
function upd(){
    let s=0;
    for(let k in cart) s+=cart[k]*price(k);
    total.innerText=s;
    amountToPay.innerText=s;

    if(payment==='card') drawQR();
}
function price(n){
    for(let c in MENU) for(let i of MENU[c]) if(i[0]==n) return i[1];
    return 0;
}

/* ====== QR DRAW ====== */
function drawQR(){
    if(!window.QRCode) return;
    const amount = Number(total.innerText || 0);

    // QR payload: –∏–Ω—Ñ–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–∫–∞—Ä—Ç–∞/–ø–æ–ª—É—á–∞—Ç–µ–ª—å/—Å—É–º–º–∞)
    const payload = `CARD:${CARD_NUMBER_RAW}\nOWNER:${CARD_OWNER}\nAMOUNT:${amount}`;

    const canvas = document.getElementById('qrCanvas');
    if(!canvas) return;

    QRCode.toCanvas(canvas, payload, { width: 220, margin: 1 }, function (error) {
        if (error) console.error(error);
    });
}

/* ====== LANG / TYPE / PAYMENT ====== */
function applyLang(){
    btnDelivery.innerText=TEXT[lang].delivery;
    btnPickup.innerText=TEXT[lang].pickup;
    address.placeholder=TEXT[lang].address;
    phone.placeholder=TEXT[lang].phone;
    cartTitle.innerText=TEXT[lang].cart;
    orderBtn.innerText=TEXT[lang].order;
    comment.placeholder=TEXT[lang].comment;
    search.placeholder=TEXT[lang].search;

    payCard.innerText = TEXT[lang].payCard;

    // Card pay texts
    cardPayTitle.innerText = TEXT[lang].cardTitle;
    cardLabel.innerText = TEXT[lang].cardLabel;
    ownerLabel.innerText = TEXT[lang].ownerLabel;
    amountLabel.innerText = TEXT[lang].amountLabel;
    copyCardBtn.innerText = TEXT[lang].copyCard;
    copyAmountBtn.innerText = TEXT[lang].copyAmount;
    sendCheckBtn.innerText = TEXT[lang].sendCheck;
    cardPayHint.innerText = TEXT[lang].cardHint;
    qrHint.innerText = TEXT[lang].qrHint;

    // Card details
    cardNumberText.innerText = formatCard(CARD_NUMBER_RAW);
    cardOwnerText.innerText = CARD_OWNER;

    renderCats();renderProducts();
    syncCardPayVisibility();
}

function setLang(l,b){
    lang=l;
    document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    applyLang();
}

function setType(t,b){
    type=t;
    document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    address.style.display=t==='pickup'?'none':'block';
}

function setPayment(p){
    payment=p;
    payCash.classList.toggle('active',p==='cash');
    payClick.classList.toggle('active',p==='click');
    payCard.classList.toggle('active',p==='card');
    syncCardPayVisibility();

    if(p==='card') setTimeout(drawQR, 0);
}

function syncCardPayVisibility(){
    cardPayBox.style.display = (payment==='card') ? 'block' : 'none';
    copiedNote.style.display = 'none';
}

/* ====== Variant B helpers ====== */
function formatCard(num){
    const s = String(num||'').replace(/\D/g,'');
    return s.replace(/(\d{4})(?=\d)/g,'$1 ').trim();
}

async function copyText(t){
    try{
        await navigator.clipboard.writeText(t);
    }catch(e){
        const ta=document.createElement('textarea');
        ta.value=t;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
    }
    copiedNote.style.display='block';
    setTimeout(()=>{copiedNote.style.display='none';}, 1300);
}

function copyCard(){ copyText(CARD_NUMBER_RAW); }
function copyAmount(){ copyText(String(total.innerText||0)); }

function buildOrderText(){
    const items=[];
    for(let k in cart) if(cart[k]>0) items.push(`${k} √ó ${cart[k]}`);
    const sum = total.innerText||0;
    const del = (type==='delivery') ? `–î–æ—Å—Ç–∞–≤–∫–∞: ${address.value||'‚Äî'}` : '–°–∞–º–æ–≤—ã–≤–æ–∑';
    const ph = phone.value||'‚Äî';
    const cmt = comment.value||'‚Äî';
    return `‚úÖ –ó–∞–∫–∞–∑ Radj Shashlik\n\nüßæ –°–æ—Å—Ç–∞–≤:\n- ${items.join('\n- ') || '‚Äî'}\n\nüí∞ –°—É–º–º–∞: ${sum} —Å—É–º\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${ph}\nüìç ${del}\nüí≥ –û–ø–ª–∞—Ç–∞: –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É\nü™™ –ö–∞—Ä—Ç–∞: ${formatCard(CARD_NUMBER_RAW)}\nüë§ –ü–æ–ª—É—á–∞—Ç–µ–ª—å: ${CARD_OWNER}\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${cmt}\n\nüìå –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å—é–¥–∞ —á–µ–∫/—Å–∫—Ä–∏–Ω –ø–µ—Ä–µ–≤–æ–¥–∞.`;
}

function openProofChat(){
    // ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é
    Telegram.WebApp.openTelegramLink(`https://t.me/${MANAGER_USERNAME}`);
}

/* ====== SEND ORDER (still via sendData) ====== */
function sendOrder(){
    const order={};
    for(let k in cart) if(cart[k]>0) order[k]=cart[k];

    if(Object.keys(order).length===0){
        alert(TEXT[lang].emptyCart);
        return;
    }

    let finalComment = comment.value || '‚Äî';
    if(payment==='card'){
        finalComment = (finalComment==='‚Äî'?'':finalComment+'\n') +
          `‚úÖ –û–ø–ª–∞—Ç–∞: –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É\n–ö–∞—Ä—Ç–∞: ${formatCard(CARD_NUMBER_RAW)}\n–ü–æ–ª—É—á–∞—Ç–µ–ª—å: ${CARD_OWNER}\n(—á–µ–∫ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —á–∞—Ç @${MANAGER_USERNAME})`;
    }

    Telegram.WebApp.sendData(JSON.stringify({
        order,
        phone:phone.value||'‚Äî',
        comment:finalComment,
        delivery:type,
        address:type==='delivery'?address.value:'–°–∞–º–æ–≤—ã–≤–æ–∑',
        total:total.innerText,
        payment,
        card: payment==='card' ? { number: CARD_NUMBER_RAW, owner: CARD_OWNER } : null,
        lang
    }));
    Telegram.WebApp.close();
}

/* ====== INIT ====== */
applyLang();
</script>

</body>
</html>
